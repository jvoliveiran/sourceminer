<html layout:decorator="layouts/layout">
	<head>
		<meta charset="UTF-8"/>
		
		<script type="text/javascript">
		
		function getFileContentInRevision(path){
			var revisionNumber = $("#revisionFile").val();
			
			$.ajax({
	            type: "POST",
	            url: "/SourceMiner/dashboard/file_content_revision",
	            data: { 'revisionNumber': revisionNumber, 'path': path  },
	            success: changeFileContentRevision,
	            error : function(e) {
					console.log("ERROR: ", e);
				},
				done : function(e) {
					console.log("DONE");
				}
	            });
		}
		
		function changeFileContentRevision(data, status){
			$('#fileContentBox').text(data);
		}
		</script>
		
	</head>
	
	<div layout:fragment="content">
		<div class="col-md-10">
				<h3>Dashboard - Detalhes arquivo</h3>
			</div>
			<div class="col-md-2">
				<form action="#" th:action="@{/dashboard/project_dashboard}" method="post">
					<input type="hidden" name="idProject" th:value="${project.id}" />
					<input type="submit" class="btn btn-primary" value="Dashboard" />
				</form>
			</div>
		
		<!-- Primeira linha -->
		<div class="row">
			<div class="col-md-12">
			
				<div class="panel panel-default">
				  <div class="panel-heading">
				  	<h3 class="panel-title">Informações do Projeto</h3>
				  </div>
				  <div class="panel-body">
				  
				  	<div class="row">
					    <div class="col-md-2">
					    	<b>Repositório:</b>
					    </div>
					    <div class="col-md-10">
					    	<span th:text="${repositoryConnetionSession.connectionName}"></span>
					    </div>
				    </div>
				    
				    <div class="row">
					    <div class="col-md-2">
					    	<b>Projeto:</b>
					    </div>
					    <div class="col-md-10">
					    	<span th:text="${project.name}"></span>
					    </div>
				    </div>
				    
				  </div>
				</div>
				
			</div>
		</div>
		
		<hr />
		
		<div class="row">
			<div class="col-md-12">
				<div class="panel panel-default">
				  <div class="panel-heading">
				  	<h3 class="panel-title">Detalhes do arquivo</h3>
				  </div>
				  
				  <div class="panel-body">
				  	<div class="row">
				  		<div class="col-md-2">
				  			<b>Nome:</b>
				  		</div>
				  		<div class="col-md-10">
				  			<span th:text="${item.name}" />
				  		</div>
				  	</div>
				  	
				  	<div class="row">
				  		<div class="col-md-2">
				  			<b>Path:</b>
				  		</div>
				  		<div class="col-md-10">
				  			<span th:text="${item.path}" />
				  		</div>
				  	</div>
				  	
				  	<div class="row">
				  		<div class="col-md-2">
				  			<b>Projeto:</b>
				  		</div>
				  		<div class="col-md-10">
				  			<span th:text="${project.name}" />
				  		</div>
				  	</div>
				  	
				  </div>
				</div>
			</div>
		</div>
		
		<hr />
		
		<h3>Conteúdo do arquivo</h3>
		<div class="row">
			<div class="col-md-12">
				<div class="panel panel-default">
				  <div class="panel-heading">
				  	<h3 class="panel-title">
				  		<div class="row">
					  		<div class="col-md-11">
					  			<span th:text="${item.name}" />
					  		</div>
					  		<div class="col-md-1">
					  			<select class="form-control" id="revisionFile" th:onchange="'getFileContentInRevision(\'' + ${item.path} + '\');'">
								    <option th:each="revisionNumber: ${revisionsNumber}"
								            th:value="${revisionNumber}"
								            th:text="${revisionNumber}">Local</option>
								</select>
							</div>
						</div>
				  	</h3>
				  </div>
				  <div class="panel-boddy">
				  	<div class="code-block">
				  		<pre>
				  			<code th:text="${fileContent}" id="fileContentBox"></code>
				  		</pre>
				  	</div>
				  </div>
				</div>
			</div>
		</div>
		
		<hr />
		
		<div class="row">
			<div class="col-md-12">
				<div class="panel panel-default">
				  <div class="panel-heading">
				  	<h3 class="panel-title">Revisões</h3>
				  </div>
				  
				  <div class="panel-body">
				  	<table class="table table-striped">
				  		<thead>
				  			<th>Revisão</th>
				  			<th>Comentário</th>
				  			<th>Autor</th>
				  			<th>Data</th>
				  			<th>Detalhes</th>
				  		</thead>
				  		<tr th:each="revisionItem : ${item.revisionItem}">
				  			<td th:text="${revisionItem.repositoryRevision.revision}"></td>
				  			<td th:text="${revisionItem.repositoryRevision.comment}"></td>
				  			<td th:text="${revisionItem.repositoryRevision.author}"></td>
				  			<td th:text="${revisionItem.repositoryRevision.dateRevision}"></td>
				  			<td>
				  				<form action="#" th:action="@{/dashboard/revision_details}" method="post">
				  					<input type="hidden" name="idRevision" th:value="${revisionItem.repositoryRevision.id}" />
				  					<input type="submit" class="btn btn-primary btn-xs" value="Detalhes" />
				  				</form>
				  			</td>
				  		</tr>
				  	</table>
				  </div> 
				</div>
			</div>
		</div>
		
		<hr />
		
	</div>
	

</html>